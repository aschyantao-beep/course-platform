<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿç™»å½•æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 50px auto; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px 0; }
        button:hover { background: #0056b3; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸš€ å¿«é€Ÿç™»å½•æµ‹è¯•</h1>

    <div id="status" class="status info">è¯·ç™»å½•æˆ–æ³¨å†Œ</div>

    <form id="login-form">
        <div class="form-group">
            <label for="email">é‚®ç®±:</label>
            <input type="email" id="email" required placeholder="è¯·è¾“å…¥é‚®ç®±">
        </div>
        <div class="form-group">
            <label for="password">å¯†ç :</label>
            <input type="password" id="password" required placeholder="è¯·è¾“å…¥å¯†ç ">
        </div>
        <button type="submit">ç™»å½•</button>
        <button type="button" onclick="register()">æ³¨å†Œæ–°è´¦å·</button>
    </form>

    <button onclick="window.location.href='index.html'">è¿”å›é¦–é¡µ</button>

    <!-- ç›´æ¥å¼•å…¥Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // Supabaseé…ç½®
        const SUPABASE_URL = 'https://ebylczerbbhkccfoefgk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVieWxjemVyYmJoa2NjZm9lZmdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2OTM2MjEsImV4cCI6MjA3OTI2OTYyMX0.q7_8UU29lyMPaY-1xRoT1UeLEJFcjepcogk8rfKt8lI';

        // åˆ›å»ºSupabaseå®¢æˆ·ç«¯
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        // ç™»å½•
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            showStatus('æ­£åœ¨ç™»å½•...', 'info');

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    showStatus(`ç™»å½•å¤±è´¥: ${error.message}`, 'error');
                } else {
                    showStatus('ç™»å½•æˆåŠŸï¼æ­£åœ¨è·³è½¬...', 'success');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1500);
                }
            } catch (error) {
                showStatus(`ç™»å½•å¼‚å¸¸: ${error.message}`, 'error');
            }
        });

        // æ³¨å†Œ
        async function register() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!email || !password) {
                showStatus('è¯·å¡«å†™é‚®ç®±å’Œå¯†ç ', 'error');
                return;
            }

            showStatus('æ­£åœ¨æ³¨å†Œ...', 'info');

            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });

                if (error) {
                    showStatus(`æ³¨å†Œå¤±è´¥: ${error.message}`, 'error');
                } else {
                    showStatus('æ³¨å†ŒæˆåŠŸï¼è¯·æ£€æŸ¥é‚®ç®±éªŒè¯é“¾æ¥', 'success');
                }
            } catch (error) {
                showStatus(`æ³¨å†Œå¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                showStatus(`æ‚¨å·²ç»ç™»å½•: ${session.user.email}`, 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è®¤è¯çŠ¶æ€
        document.addEventListener('DOMContentLoaded', checkAuth);
    </script>
</body>
</html>